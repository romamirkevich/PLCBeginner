| [<- до лаборної роботи 0 install](lab0_install.md) | [лабораторні](README.md) |
| -------------------------------------------------- | ------------------------ |
| [на основну сторінку курсу](../README.md)          |                          |

# **ЛАБОРАТОРНА РОБОТА 1**

## **Конфігурування ПЛК Modicon M221**. **Робота зі змінними I/O. Основи програмування**

**Мета:** ознайомлення із середовищем EcoStruxure Machine Expert - Basic, принципами конфігурування ПЛК Modicon M221, робота із зовнішніми змінними, основи програмування.

### **1. Лабораторна установка**

**1.1. Програмне забезпечення.** EcoStruxure Machine Expert – Basic.

**1.2 Завдання для виконання роботи.** Необхідно створити конфігурацію ПЛК Modicon M221 відповідно до варіанту, створити програму користувача.

### **2. Ознайомлення із середовищем**

**2.1 Запустіть редактор EcoStruxure Machine Expert - Basic**

На наступній діаграмі показані типові етапи розробки проекту на EcoStruxure Machine Expert - Basic (вкладки **Configuration**, **Programming** та **Commissioning**):

![pic_1](media1/pic_1.PNG)

Рис. 1.1  етапи розробки проекту на EcoStruxure Machine Expert – Basic

Панель EcoStruxure Machine Expert – Basic має наступний вигляд: (рис. 1.2):

![pic_2](media1/pic_2.PNG)

Рис. 1.2 Панель інструментів EcoStruxure Machine Expert – Basic

Панель інструментів знаходиться у верхній частині вікна EcoStruxure Machine Expert – Basic, і надає доступ до часто використовуваних функцій.

На панелі інструментів розміщено такі кнопки:

| **Значок**                    | **Опис**                                                     |
| ----------------------------- | ------------------------------------------------------------ |
| ![](media1/clip_image001.png) | Відкрити меню "Start".                                       |
| ![](media1/clip_image003.png) | Створити новий проект (CTRL + N)                             |
| ![](media1/clip_image005.png) | Відкрити існуючий проект (CTRL + O)                          |
| ![](media1/clip_image007.png) | Зберегти поточний проект (CTRL + S). Клацніть  стрілку вниз, щоб відобразити меню з додатковими параметрами збереження. |
| ![](media1/clip_image009.png) | Роздрукувати звіт (CTRL + P). Клацніть  стрілку вниз, щоб вибрати звіт для друку або налаштувати вміст та формат  звіту. |
| ![](media1/clip_image011.png) | Вирізати (CTRL + X)                                          |
| ![](media1/clip_image013.png) | Копіювати (CTRL + C)                                         |
| ![](media1/clip_image015.png) | Вставити (CTRL + V)                                          |
| ![](media1/clip_image017.png) | Скасувати (CTRL + Z). Клацніть один раз, щоб  скасувати останню дію в редакторі програми. Клацніть стрілку вниз та виберіть  дію зі списку, щоб скасувати всі дії до та включення вибраної дії. Можна  скасувати до 10 дій. |
| ![](media1/clip_image019.png) | Повторити (CTRL + Y). Клацніть один раз, щоб  скасувати останню дію «Скасувати». Клацніть стрілку вниз та виберіть дію зі  списку, щоб повторити всі дії до вибраної дії. Можна повторити до 10 дій. |
| ![](media1/clip_image021.png) | Відкрити вікно «Налаштування системи».                       |
| ![](media1/clip_image023.png) | Довідка. Клацніть стрілку вниз та виберіть  дію зі списку. Показувати онлайн-довідку чи контекстну довідку, примітки,  навчальні посібники та документи електронного навчання, звернутись у технічну  підтримку Schneider Electric. |
| ![](media1/clip_image025.png) | Перевести ПЛК в режим **«RUNING»** (CTRL + M). Доступний лише в онлайн-режимі і тоді, коли контролер ще  не знаходиться у режимі **«****RUNING»**. |
| ![](media1/clip_image027.png) | Перевести ПЛК в режим **«STOP»** (CTRL + L). Доступний лише в онлайн-режимі та коли контролер  знаходиться у режимі **«RUNING»**. |
| ![](media1/clip_image029.png) | Ініціалізувати ПЛК. Доступно лише в  онлайн-режимі.          |
| ![](media1/clip_image031.png) | Компілювати програму                                         |
| ![](media1/clip_image033.png) | Підключитися (CTRL + G) або відключитися  (CTRL + H) від вибраного контролера.  ПРИМІТКА: Ім'я вибраного контролера  з'являється зліва від цієї кнопки |
| ![](media1/clip_image035.png) | Запустити (CTRL + B) або зупинити (CTRL + W)  **симулятор** EcoStruxure Machine Expert – Basic |

Область стану у верхній частині головного вікна відображає інформацію про поточний стан системи (рис. 1.3):

![](media1/pic_3.PNG)

Рис. 1.3 Область стану EcoStruxure Machine Expert – Basic

1. **Стан програми**: вказує, чи виявлені в програмі помилки чи ні.

2. **Стан з'єднання**: вказує стан з'єднання між EcoStruxure Machine Expert - Basic та контролером, або імітатором контролера.

3. **Стан контролера**: вказує поточний стан логічного контролера (RUNNING, STOPPED, HALTED та ін.).

4. **Час сканування**: Показує останній час сканування.

5. **Помилка контролера, що була виявлена останньою**: Показує останню виявлену помилку. Інформація витягується із системних бітів та системних слів, якщо контролер знаходиться в стані STOPPED або HALTED.

   ### **3. Огляд вікна властивостей**

Вкладка " **Properties** " дозволяє вказувати інформацію про проект та захищати його паролем (рис. 1.4):

![](media1/pic_4.PNG)

Рис. 1.4 Вікно властивостей EcoStruxure Machine Expert – Basic

Вікно **Properties** використовується для того, щоб отримати детальну інформацію про користувача EcoStruxure Machine Expert - Basic, компанії, яка розробляє додаток, та проект. У цьому вікні також можна захистити паролем файл проекту та програми, коли вони записуються в контролер.

У вікні **Propertis** вкажіть Ваше **прізвище** в поле **Last** **Name** та ім’я у поле **First** **Name**

**3.2 Захист проекту паролем**

Файл проекту можна зашифрувати та захистити паролем.

Якщо проект зашифрований, буде запропоновано ввести пароль шифрування кожного разу, коли Ви намагаєтесь відкрити проект.

Якщо проект захищений від модифікацій, то його можна лише переглянути. Щоб змінити проект, необхідно ввести пароль.

 Для того, щоб зашифрувати та захистити паролем файл проекту необхідно виконати такі дії:

| **Крок** | **Дія**                                                      |
| -------- | ------------------------------------------------------------ |
| 1.       | Відкрийте вкладку **Properties** та натисніть **Project  Properties → Project Protection**. |
| 2.       | Виберіть опцію **Active**. Обов’язкові поля для введення інформації позначаються  зірочкою (*). |
| 3.       | Введіть  пароль і введіть його знову у якості підтвердження для шифрування проекту |
| 4.       | Опціонально можна ввести пароль та його  підтвердження для захисту проекту від модифікацій. |
| 5.       | Натисніть **Apply**.                                         |

**3.3 Відключення захисту з проекту**

Для відключення захисту проекту паролем необхідно виконати такі дії:

| **Крок** | **Дія**                                                      |
| -------- | ------------------------------------------------------------ |
| 1.       | Відкрийте вкладку **Properties** та натисніть **Project  Properties → Project Protection**. |
| 2.       | Виберіть опцію **Inactive****.**                             |
| 3.       | Натисніть **Apply.**   **ПРИМІТКА**. Якщо з'явиться запит на пароль модифікації, необхідно ввести пароль  для модифікації проекту та натиснути **Apply**. |

### **4. Огляд вікна конфігурації**

Вікно **Configuration** (рис. 1.5) використовується для створення конфігурації обладнання контролера та модулів розширення, на базі яких буде розробляться програма.

![](media1/pic_5.PNG)

Рис. 1.5 Загальний вигляд вікна Configuration

1 **Дерево обладнання** - структурований вигляд конфігурації обладнання.

2 **Конфігурація** – графічне представлення контролера і модулів розширення.

3 **Каталог обладнання** в ньому міститься перелік різноманітних модифікацій контролера та підтримуваних модулів розширення. Для того щоб додати компонент до конфігурації обладнання, необхідно перетягнути його у вікно **конфігурації**.

4 **Властивості компонента**, вибраного в **конфігурації**, або властивості вибраного елемента в **дереві обладнання**.

### **5. Створення конфігурації**

Для створення конфігурації необхідно виконати такі дії (рис. 1.6):

| **Крок** | **Дія**                                                      |
| -------- | ------------------------------------------------------------ |
| 1.       | Відкрийте вкладку **Configuration**.                         |
| 2.       | Розкрити категорію контролера в області  каталогу обладнання праворуч, якщо вона ще не відображається. |
| 3.       | Виберіть модифікацію контролера **TM221CE16R**.  Короткий опис фізичних властивостей контролера з'являється в області опису  пристрою. |
| 4.       | Перетягніть назву контролера на зображення вже  існуючого контролера в центральній області вікна та вдпустіть його. |
| 5.       | Натисніть кнопку **Yes**, коли з'явиться запит на підтвердження заміни контролера. |

![](media1/pic_6.PNG)

Рис. 1.6 Створення конфігурації контролера

Модулі розширення додаються з каталогу аналогічно до конфігурування контролера, шляхом перетягування конкретного модуля з каталогу в центральну робочу область (рис. 1.7).

![](media1/pic_7.PNG)

Рис. 1.7 Додавання модулів розширення

Більш детально про каталог обладнання можна дізнатися у **додатку 1.1.**

Для налаштування обраного модуля розширення, а також для конфігурування обраного процесорного модуля контролера необхідно активувати властивість модуля/контролера у **дереві обладнання** (рис. 1.8).

![](media1/pic_8.PNG)



Рис. 1.8 Проведення налаштування створеної конфігурації 

Більш детально про властивості різних модулів розширення можна дізнатись у **додатку 1.2.**

Необхідно створити конфігурацію ПЛК та його модулів, відповідно до **рис.1.9** та **таблиці 1.1** Для кожного конфігураційного вікна зробити скріншоти (копії екранів). За необхідності скорегуйте конфігурацію ПЛК.

![](media1/pic_9.PNG)

Рис. 1.9 Конфігурація Modicon M221.

*Табл. 1.1. Конфігурування окремих модулів.*

| Адр.  мод | Адреса  аналу | Назва властивості | Значення | Коментар |
| :-------: | :-----------: | :---------------: | :------: | :------: |
|     1     |       2       |         3         |    4     |    5     |
|     0     |                 **TM221CE16R**                          ||||
|           | %I0.1 | Run/Stop | **+** | Обробка Вкл/Викл ПЛК |
|           | %I0.2 | Filtering | No Filter | Не  фільтрувати сигнал |
|           |               | Event | Falling edge | Обробка подій по  задньому фронту |
|           |               | Priority | 2 | Пріоритет |
|           | %I0.4 | Filtering | 12 ms | Зміна часу  фільтрації |
|           | %Q0.1 | Status Alarm | + | Сигналізація  статусу |
|           | %Q0.2 | Fallback value | 1 | Зміна нормального  стану сигналу |
| 1 | **TM3DI16K** |                   |          |          |
|           | %I.1.0 | Symbol | PUSK | Присвоєння каналу  символьного імені |
| 2 | **TM3AI4** |  |  |  |
|           | %IW2.0 | Type | 0-10 V | Діапазон  вхідного сигналу |
|           |               | Sampling | 10 ms/Channel | Частота опитування |
|           | %IW2.1 | Type | 4-20 mA | Діапазон вхідного  сигналу |
| 3 | **TM3TM3** |                   |          |          |
|           | %IW3.0 | Type | PT100 | Діапазон  вхідного сигналу |
|           | %IW3.1 | Type | K Thermocouple | Діапазон вхідного  сигналу |
| 4 | **TM3TM3** |                   |          |          |
|           | %IW4.0 | Type | PT1000 | Діапазон вхідного  сигналу |
| | %IW4.1 | Type | J Thermocouple | Діапазон вхідного  сигналу |
| 5 | **TM3TM3** |  |  |  |
| | %IW5.0 | Type | NI100 | Діапазон вхідного  сигналу |
| | %IW5.1 | Type | E Thermocouple | Діапазон вхідного  сигналу |
| 6 | **TM3DQ16R** |  |  |  |
| | Не конфігурувати |  |  |  |
| 7 | **TM3AQ2** |  |  |  |
| | %QW7.0 | Type | 0-10 V | Тип аналогового  вихідного сигналу |
| | %QW7.1 | Type | 4-20 mA | Тип аналогового  вихідного сигналу |
| |  | Minimum | 0 | Мінімум шкали ЦАП |
| |  | Maximum | 10 000 | Максимум шкали  ЦАП |

Наприклад, відповідно до поставленого завдання налаштування модулю **TM221CE16R** (процесорний модуль) буде виглядати наступним чином (рис. 1.10-1.11):

![](media1/pic_10.PNG)

Рис. 1.10 Налаштування дискретних входів процесорного модуля

![](media1/pic_11.PNG)

Рис. 1.11 Налаштування дискретних виходів процесорного модуля

Аналогічно до процесорного модуля необхідно також виконати налаштування всіх модулів розширення відповідно до завдання. Зробити скріншоти (копії екранів).

Збережіть проект

### **6. Огляд робочої області програмування**

6.1 Створіть новий проект. 

В якості базового модуля використати **TM221CE24R**, модулі розширення не додавати.

Вкладка **Programming** розділена на 3 основні області (рис. 1.12):

![](media1/pic_12.PNG)

Рис. 1.12 Загальний вигляд вікна **Programming**

1 **Дерево програмування** дозволяє вибрати властивості програми та її об'єкти та функції, а також ряд інструментів, які можна використовувати для моніторингу та відлагодження програми.

2 Верхня центральна область - це робоча область програмування, куди ви вводите вихідний код програми.

3 Нижня центральна область дозволяє переглядати та налаштовувати властивості елемента, вибраного в **робочій області програмування** або в **Дереві програмування**.

6.2 Перейдіть до вкладки **Programming**, створіть програму, використавши такі інструменти мови програмування **LD** як **Contact** та **Coil**, знайти які можна на панелі інструментів (рис. 1.13).

![](media1/pic_13.PNG)

Рис. 1.13 Створення програми

Для елемента Contact необхідно в поле **Address** вказати адресу **%M10**, а для елемента Coil в поле **Address** вказати адресу **%Q0.1**

6.3 Для завантаження розробленої програми користувача в Modicon M221 необхідно провести підключення контролера до PC. Фізично підключення відбувається за допомогою USB порт ПК та mini-USB порт ПЛК. Програмування у середовищі EcoStruxure Machine Expert – Basic може відбуватись в двох режимах – Offline - комп’ютер не під’єднаний до контролера, Online - комп’ютер під'єднаний до контролера. Для переходу між режимами необхідно перейти до вкладки **Comissioning**. При підключенні буде запропоновано один із варіантів дій: завантажити програму у Modicon M221 або зчитати наявну у Modicon M221 програму.

6.4 EcoStruxure Machine Expert – Basic також дозволяє проводити відладку **без наявного ПЛК**, за допомогою вбудованого **симулятора**. Робота в стимуляторі аналогічна до роботи з реальним ПЛК. Для запуску стимулятора необхідно виконати **Comissioning –> Launch Simulator** (рис. 1.14)**.**

![](media1/pic_14.PNG)

Рис. 1.14 Запуск симулятора ПЛК

За роботою симулятора ПЛК можна спостерігати у окремому вікні (рис. 1.15):

![](media1/pic_15.PNG)

Рис. 1.15 Зовнішній вигляд вікна симулятора ПЛК

Modicon M221 може знаходитись у двох режимах роботи – **RUN** або **STOP**. В режимі **RUN** відбувається виконання програми користувача, яка знаходиться в пам’яті контролера, в режимі **STOP** програма не виконується.

Для переходу між режимами роботи необхідно скористатись відповідними кнопками (рис. 1.16):

![](media1/pic_16.PNG)

Рис. 1.16 Зміна режимів RUN/STOP контролера

Переведіть контролер в режим **RUN** натиснувши кнопку **Start** **Controller**

Для відладки розроблених програм дуже зручно користуватись таким інструментом як **Animation** **tables** (таблиці анімацій)

 **6.5 Таблиці анімацій** є складовою програми EcoStruxure Machine Expert - Basic, і тому вони завантажуються в контролер як частина **непрограмних** даних разом з програмою.

Це дозволяє переглядати/змінювати об’єкти, що зберігаються в анімаційних таблицях, після зчитування даних з контролера.

 Створення анімаційної таблиці (рис. 1.17-1.18)

| **Крок** | **Дія**                                                      |
| -------- | ------------------------------------------------------------ |
| 1.       | У лівій частині вікна **Programming**  виберіть вкладку **Tools**. |
| 2.       | Клацніть правою кнопкою миші на  **Animation  tables** та виберіть **Add new  animation table** з контекстного меню, яке з'явиться.  **Результат**: з’явиться новий елемент таблиці анімацій в області «**Animation tables**» у вкладці «**Tools**», а в нижній центральній області вікна  з’являється вікно властивостей. |

![](media1/pic_17.PNG)

Рис. 1.17 Процедура створення таблиці анімації

![](media1/pic_18.PNG)

Рис. 1.18 Результат створення таблиці анімації

Додавання окремих об’єктів до анімаційної таблиці (рис. 1.19).

| **Крок** | **Дія**                                                      |
| -------- | ------------------------------------------------------------ |
| 1.       | У лівій частині вікна **Programming**  виберіть вкладку **Tools**. |
| 2.       | Виберіть таблицю анімації, яку потрібно  налаштувати в області «**Animation  tables**» у вкладці«**Tools**»  **Результат**: В нижній центральній області вікна з'явиться вікно властивостей обраної  таблиці |
| 3.       | Щоб додати новий об’єкт у нижній частині  таблиці анімації, введіть ім'я об'єкта в текстове поле та натисніть **Enter** або натисніть кнопку **Add**.  Необхідно додати до таблиці елементи **%M10 та** **%Q0.1** |

![](media1/pic_19.PNG)

Рис. 1.19 Додавання окремих об’єктів до анімаційної таблиці

Використовуючи дану таблицю модифікуйте значення змінної **%M10** з «0» в «1», використовуючи колонку «**Value**»

Переконайтеся, що у відповідності до розробленої програми, значення змінної **%Q0.1** автоматично змінилось на «1»

Візуалізацію роботи програми можна спостерігати у центральному вікні редактора програми (рис. 1. 20)

![](media1/pic_20.PNG)

Рис. 1.20 використання таблиці анімацій

**Знайдіть на індикаторах симулятора ПЛК, який канал змінився.**

Згідно варіанту виконайте **індивідуальне завдання** з конфігурування контролера. 

### **7. Контрольні питання** 

1. Для вирішення яких задач використовується програмне забезпечення EcoStruxure Machine Expert - Basic?

2. Які є формати процесорних модулів контролерів Modicon M221?

3. Які є модулі розширення контролерів Modicon M221?

4. Що таке дискретні модулі? З якими сигналами вони працюють?

5. Що таке аналогові модулі? З якими сигналами вони працюють?

6. До яких типів модулів підключаються аналогові, дискретні датчики?

7. До яких типів модулів підключаються аналогові, дискретні виконавчі механізми?

8. Які засоби потрібні щоб підключити термометри опору до аналогового вхідного модуля з вхідним сигналом 0-10В?

9. Які змінні ПЛК отримують інформацію з вхідних каналів?

10. Значення яких змінних ПЛК надходить на виходи ПЛК?

11. Як зберігається значення аналогових входів/виходів в ПЛК?

12. Як функціонує робочий цикл ПЛК? 

13. Які режими роботи ПЛК Ви знаєте? Чим відрізняються ці режими? Чи може програма в ПЛК працювати без комп’ютера з EcoStruxure Machine Expert - Basic? 

### **Додаток 1.1. Каталог апаратного забезпечення Somachine basic**

Каталог апаратного забезпечення Somachine basic складається з таких пунктів:

1. Модулі центральних процесорів (M221 Logic controllers) – містить перелік модулів центральних процесорів, розділений на 2 групи: Compact та Modular.

2. Модулі розширення (I/O modules) – містить перелік модулів розширення ПЛК, розділений на 6 груп: 

   a. дискретні модулі розширення(TM3 Digital I/O Modules) – містить вхідні та вихідні дискретні модулі на 4, 8, 16 та 32 канали.

   b. аналогові модулі розширення (TM3 Analog /O Modules) – містить аналогові вхідні, вихідні та змішані аналогові модулі.

   c.  TM2 дискретні модулі розширення(TM2 Digital I/O Modules) – застарілі модулі розширення TSX Twido, присутні в каталозі для сумісності із застарілим обладнанням.

   d. TM2 аналогові модулі розширення (TM2 Analog /O Modules) – містить застарілі модулі розширення TSX Twido, присутні в каталозі для сумісності із застарілим обладнанням.

   e.  Спеціальні модулі (TM3 Expert I/O Modules) – модулі, що виконують спеціальні функції, наприклад функції безпеки

Картриджі (M221 Cartridges) – містить картриджі розширення, які можна розмістити в модулі CPU.

![](media1/pic_21.PNG)

Рис. 1.21. Каталог апаратного забезпечення Somachine basic.

### **Додаток 1.2. Конфігурування модулів** **Modicon** **M221**

Конфігурування модулів **Modicon** **M221** відбувається в розділі Configuration.

При конфігуруванні **дискретних вхідних** сигналів можливе налаштування наступних параметрів:

1. Symbol – присвоєння символьного імені змінній.

2. Filtering – встановлення/зміна часу фільтрації.

3. Latch – використання «защіпки», що дозволяє фіксувати короткочасні сигнали, тривалість яких менша за цикл контролера.

4. Run/Stop – присвоєння входу функції управління станом контролера.

5. Event – прив’язка апаратної події до каналу.

6. Priority – пріоритет апаратної події.

При конфігуруванні **дискретних вихідних** сигналів можливе налаштування наступних параметрів:

1. Symbol – присвоєння символьного імені змінній.

2. Status Alarm – використання виходу у якості аварійного сигналізатора.

3. Fallback value – нормальний стан виходу, коли ПЛК у стані STOP.

При конфігуруванні **аналогових вхідних** сигналів можливе налаштування наступних параметрів:

1. Symbol – присвоєння символьного імені змінній.

2. Type – тип вхідного сигналу. 

3. Scope – шкала, по якій відбувається масштабування сигналу.

4. Minimum – нижня межа шкали.

5. Maximum – верхня межа шкали

При конфігуруванні **аналогових вихідних** сигналів можливе налаштування наступних параметрів:

1. Symbol – присвоєння символьного імені змінній.

2. Type – тип вхідного сигналу.

3. Scope – шкала, по якій відбувається масштабування сигналу.

4. Minimum – нижня межа шкали.

5. Maximum – верхня межа шкали.

Fallback value – нормальний стан виходу, коли ПЛК у стані STOP.